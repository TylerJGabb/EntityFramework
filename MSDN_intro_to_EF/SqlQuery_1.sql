DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'MigrationsDemo.BlogContext'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201803241834231_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[Blogs] (
        [BlogId] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Blogs] PRIMARY KEY ([BlogId])
    )
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201803241834231_InitialCreate', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A1810ACE1CC9999C3B950FFFCF577F469AD247906EB84D1637A363AA504746252A157639AFBE5FB0FF4D3C75FDE45D7A95A931FB5DE45D0434BEDC6F4C9FBEC9231973C81E26EA444628D334B3F4A8C623C35ECFCF4F4777676C60021286211127DCFB5170A8A2FF87562740299CFB99C9B14A4ABE4781217A8E4962B70194F604CE76265B9C728DC1494A1E44A0A8E51C420979470AD8D2F4E2F1F1DC4DE1ABD8A331470F9B0C900F5965C3AA862BF6CD50F4DE3F43CA4C15AC31A2AC99D37EA48C0B38B8A17D6377F13BBB4E10D99BB4686FD26645DB037A69FA55951D2777439913628F5891D05F513D20883ECA42900AC93F0774226B9F4B985B186DC5B2E4FC87DBE9022F90A9B07F307E8B1CEA5EC868581E1D9960045F7D66460FDE63B2C3BC1CE524AD8B62DEB1B37A63DBB32A599F617E794DC62107C21A1B9FD4EFAB13716BE80064C13D27BEE3D58BCBC590A057F83087AFEC267ED0DCB0DBB8692395F7F03BDF24FC8295F537223D690D6922A82472DB0C9D0C8DB1CF63979B4F227FB88585B1EC3A2C176F45C20251D52830CD6FE8502C246AB6AC855AEB693293163F01D3447491B40D9BCA3B23E5F8AB289A79D0BAC1C0CF500613B264834E759868475264A252171394E26EFE3E37B4D95182C712FB45C136DE3094B8CAFA0778AAE31D21B619D9F72CF173C5CD9245503B52EFB3B98AD3D7509EEF758CB77AD1DFE2F2D5E68FDBE7DCBDC0D26A3B03B8ABCA089A11A3003B3628873C9ED8E4E9D18992BFD5AD7BF8652F65F17A3941C8E50345717A0100CED23D6CBBF4F301B30DC9B5DFDEB7AADD2FB2A8DF7A6E27B951D5555B67F810ECAAE54A1048979166928B978E33CA8515018C57FCA8914986FAB30E75A2CC1F972C453DC63E7BD3DFCFFD989CCB9541EB018FFB31D2502B37BB7D060851DBE96F433B7C913B7BF2ABEFEAD8B74E4EA3902E7B8F5329C83FB17C8CEFD5116F398A60B7C1B3E9401561BE78DAB65D85811EBBE5FA32938B16A21C26B5643122AB605AD75667A696A8A31A36E44B54AEF06E6E0798AC45C592F963CF1789C8073C52BE0079739AA5CAB05A4337D97FB2CF757CE815AC8AD974BC45EF75FECCFED98A3BBAC58083F23050C53600A70A73FE742A64DDC37C352DE05116AA4EA0F8C0A5F4108B7DA3448B7461F0854D137850C74E8AE075099443077A763FE0C6F890D1F40DF60C5934D3D1F7783ECBF886DDAA3A9E0B89A95AB305AFBF09B8C851F651FFF05EA9078B7C60D0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201803241848130_AddBlogUrl'
BEGIN
    ALTER TABLE [dbo].[Blogs] ADD [Url] [nvarchar](max)
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201803241848130_AddBlogUrl', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A1810ACE1CC9999C3B950FFFCF577F469AD247906EB84D1637A363AA504746252A157639AFBE5FB0FF4D3C75FDE45D7A95A931FB5DE45D0434BEDC6F4C9FBEC9231973C81E26EA444628D334B3F4A8C623C35ECFCF4F4777676C60021286211127DCFB5170A8A2FF87562740299CFB99C9B14A4ABE4781217A8E4962B70194F604CE76265B9C728DC1494A1E44A0A8E51C420979470AD8D2F4E2F1F1DC4DE1ABD8A331470F9B0C900F5965C3AA862BF6CD50F4DE3F43CA4C15AC31A2AC99D37EA48C0B38B8A17D6377F13BBB4E10D99BB4686FD26645DB037A69FA55951D2777439913628F5891D05F513D20883ECA42900AC93F0774226B9F4B985B186DC5B2E4FC87DBE9022F90A9B07F307E8B1CEA5EC868581E1D9960045F7D66460FDE63B2C3BC1CE524AD8B62DEB1B37A63DBB32A599F617E794DC62107C21A1B9FD4EFAB13716BE80064C13D27BEE3D58BCBC590A057F83087AFEC267ED0DCB0DBB8692395F7F03BDF24FC8295F537223D690D6922A82472DB0C9D0C8DB1CF63979B4F227FB88585B1EC3A2C176F45C20251D52830CD6FE8502C246AB6AC855AEB693293163F01D3447491B40D9BCA3B23E5F8AB289A79D0BAC1C0CF500613B264834E759868475264A252171394E26EFE3E37B4D95182C712FB45C136DE3094B8CAFA0778AAE31D21B619D9F72CF173C5CD9245503B52EFB3B98AD3D7509EEF758CB77AD1DFE2F2D5E68FDBE7DCBDC0D26A3B03B8ABCA089A11A3003B3628873C9ED8E4E9D18992BFD5AD7BF8652F65F17A3941C8E50345717A0100CED23D6CBBF4F301B30DC9B5DFDEB7AADD2FB2A8DF7A6E27B951D5555B67F810ECAAE54A1048979166928B978E33CA8515018C57FCA8914986FAB30E75A2CC1F972C453DC63E7BD3DFCFFD989CCB9541EB018FFB31D2502B37BB7D060851DBE96F433B7C913B7BF2ABEFEAD8B74E4EA3902E7B8F5329C83FB17C8CEFD5116F398A60B7C1B3E9401561BE78DAB65D85811EBBE5FA32938B16A21C26B5643122AB605AD75667A696A8A31A36E44B54AEF06E6E0798AC45C592F963CF1789C8073C52BE0079739AA5CAB05A4337D97FB2CF757CE815AC8AD974BC45EF75FECCFED98A3BBAC58083F23050C53600A70A73FE742A64DDC37C352DE05116AA4EA0F8C0A5F4108B7DA3448B7461F0854D137850C74E8AE075099443077A763FE0C6F890D1F40DF60C5934D3D1F7783ECBF886DDAA3A9E0B89A95AB305AFBF09B8C851F651FFF05EA9078B7C60D0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201803241854469_AddPostClass'
BEGIN
    CREATE TABLE [dbo].[Posts] (
        [PostId] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](200),
        [Content] [nvarchar](max),
        [BlogId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Posts] PRIMARY KEY ([PostId])
    )
    CREATE INDEX [IX_BlogId] ON [dbo].[Posts]([BlogId])
    CREATE UNIQUE INDEX [IX_Title] ON [dbo].[Posts]([Title])
    ALTER TABLE [dbo].[Blogs] ADD [Rating] [int] NOT NULL DEFAULT 3
    ALTER TABLE [dbo].[Posts] ADD CONSTRAINT [FK_dbo.Posts_dbo.Blogs_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [dbo].[Blogs] ([BlogId]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201803241854469_AddPostClass', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF22DEB4D8B05820D397338333C339C51FEF9EBEFC18765C8C90BC48A493174CE7AA70E01E1CB8089C5D049F4FCDD8FCE87F7DF7E33B80EC225F95CC85D1839D4146AE83C6B1DF55D57F9CF1052D50B991F4B25E7BAE7CBD0A58174CF4F4F7F72CFCE5C400807B10819DC2742B310D25FF0D791143E443AA17C2203E02A5FC71D2F4525B7340415511F86CE842D62AAD10A7505A174C8256714ADF080CF1D4285903ADDED3F2AF0742CC5C28B7081F28755042837A75C416E7B7F2DBEAB1BA7E7C60D77AD5840F989D232DC13F0EC228F8B6BAB1F145DA78C1B46EE1A23AC57C6EB347A43E723970B87D807F5473C364276607B46FC84948B66EDA42400F2C4FC3B21A384EB2486A18044C7949F90BB64C699FF0BAC1EE46F208622E1BC6A161A867BB5055CBA8B6504B15EDDC3BC62EC3870885BD7756DE552D5D2CB5C1A0B7D71EE905B3482CE3894B75F71DFD332869F4100BA09C11DD51A62BCBC710069FC1A1658E7999FC5694837CC1A874CE8F21388857EC698D2A5436ED812826225B7E051304C3254D27102DB0E798CF9D1CFB8C77018E0CD81B3306EE90B5BA471B4D0EEA4D2CA21F7C033463DB3284BD19ED979CAA87813CBF05EF25C3C5D7C7AA0F102349A21ED1D4F26B16F993070D72CDFC87D03B313F753EA1BE9B7A3BE39FD10EA177A5F8BFA0F4CF34DDCC7C2F40578894F83467B8ECEFFDD0AC7AEFCCF08BE3FFD0B9237E95F24C62EF4BF544AFA2C3DBAC28DECD8BA03D722209D3664012FACC69823E1598414C72387CE0F8D68B48195F9BC06CBBCAF839D39765E4C31ED386820977EF69C8EA8F269D0BC038C41505FC15482D8709872648FC2E4644237F38E099F459477996C29ECF14A19A34A787BE70A221026C3BAE2FEBA734B782B48DB6232702BA46996529385A80171C5803433976D65155BAFBCB2AA3CF96CA2184C0F74050D5F8B35996B4C69B0ACAE9C3F350DE58CB39672C5C93A429E9395FD46C2DAB1DE943BA591A57D8DABDA942D15F53C3636E9EB8EB4D484F2C6D6BDB49B35D345D3ED7674DD83098D222CB2952E3C5F215ED6828FDE79FBF7A76186E1FAAAA54D2DAD2D4FC2B7892EC0DA35CF4100372C56FA8A6A3AA3A6268F82B02156E567077D8A93AA146CDE5141AA42DAFC3FD36869975B7237D7BB41674293F4E99B6B5D6F532D1D7C28A771C72335923C09C5E65AD08D92F5AC558C6C657784B421AD02A40BBBEB17CD6615A2586BA20C5C2B8A8DAAD7B8A7C61351BFF49D289125EE2B289156A0FD29D1AED615CAA2EBAB86B2BD83DC8492F77255907C69778CB253ABA2948BBBE3EC47F2A392A3514C6D91F2F4B2A85AC5739017B2EDDF351A952D13710886E78505A6AA792BA521EC19819EF73B1F719686B6109850C1E6A074367E60FF7D766E7D1EF9EF7CAA70950AF80EDF2BDEECD3013391DD3A216D1B10367C2D102F34F69F69FC5D4897DF5791F6FC22F02A9CFAD49FFABCD1A5FD06EE371B7E8F7279B579B7887A73E2DDEF02ACF1F65597D942E0466B3EC6E1603974FE4855FA64FCEB53A67542A63196903E39257F1EC88143A6CEACEBFE9AC361BDED3E60CA3D68BAECE80E8F3651FE3FA6C86633BF7D4EEC1C13B3E772E8043389B79AB1B77D786A9B203B07C836D8D691EE48B365D5E7F5C4B06D9C6C4CA0C799209BCD0D72A4F2A71DE4A6628B3584F9438F00BFC68E52662CE6B220A96551216215BC09681A20752E63CDE6D4D7B8ED8352E98BF699F20445AEC3190463314D7494687419C219AF7DD93464DF747E3A26D76D1E4CA3B4C9FF122EA0990C5D80A9F898301E9476DFB4D4DD0E089345F93367EE529BE76EB12A916EA5D811280F5F99FC0F10461CC1D45478F4050EB1ED51C12758507F55F4A8DD20DB2FA21EF6C115A3386E852AC758EBE3AFC8E1205CBEFF1777AF3249E11C0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201803241859485_AddPostAbstract'
BEGIN
    ALTER TABLE [dbo].[Posts] ADD [Abstract] [nvarchar](max)
    UPDATE dbo.Posts SET Abstract = LEFT(Content, 100) WHERE Abstract IS NULL
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201803241859485_AddPostAbstract', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF225899316018C98E41CCE0CCF0C67E87FFEFA7BF0691972F204B162520C9D93DEB14340F83260623174123DFFF0A3F3E9E3B7DF0C2E837049BE16EBCECC3A94146AE83C6A1DF55D57F98F1052D50B991F4B25E7BAE7CBD0A581744F8F8F7F724F4E5C400807B10819DC2642B310D22FF87524850F914E289FC800B8CAC771C64B51C9350D4145D487A133618B986AD4425D40281D72CE19452D3CE073875021A44E67FBF70A3C1D4BB1F0221CA0FC6E1501AE9B53AE20D7BDBF5EBEAB19C7A7C60C772D5840F989D232DC13F0E42CF78B6B8B3FCBBB4EE937F4DC257A58AF8CD5A9F786CE672E170EB137EA8F786C16D98EED99E547A41C34634725019027E6EF888C12AE93188602121D537E446E921967FE2FB0BA93BF81188A84F3AA5AA818CED50670E8269611C47A750BF38AB2E3C0216E5DD6B5854B514B2E33692CF4D9A943AE51093AE3509E7EC57C4FCB187E060168260437546B88F1F0C601A4FE6B6860ED673E8BDD906E18350E99D0E517100BFD883EA54B875CB12504C548AEC1BD60186428A4E304B66D721FF383EF718BEE30C09B1D67615CD327B648FD68A1DD48A595436E81678C7A645116A23D33F39051F12A96E1ADE4F9F274F0E18EC60BD0A886B4673C99C4BEA5C2C05DB37C23F70DCC4EDC4FA96F56BF1FF5CDEECFA17E21F756D4BF639A6FE23E26A657E0255E0D1AF53938FF774B1C9B31CE670A99E01F40D9CE40CB2269FF382BA2A919674504EE1267E74A499FA55B5748986D5B37E05204A45387CC5985D6E82F8C2C16612CE19643E7878637DAC0CAC4B106CBACAF839D3876004E31BE396820E77E766F8FA8F269D03C03F441501FC19885D8040BE5485373F64CE8668033E1B388F22E952D813DAE43A354096FCF5C4004C2847297DF5FB66F096F39699B4F066E8534CD9C6DC21D2520AE2890A680655BFEC61A2F4FE12A0F1C9B2806D3035D41C36B694DE61A531A2CAB0BE7775A4338E3AC255C31B28E90C76465BE11B0B6AF37C54EA964A95FE3A836454B453CF78D4DFABA212D39A13CB175D1EE66557B51DDBB1DE5FD6042A3081364A5DCCF478897D5FAA30FDEFE85709861B8BE6AA9874B6DCB9DF012A40BB066CDBD13C0158B95BEA09ACEA849D1A3206C2CABF2B3833EC54E550A36CFA82055B1DAFC9F49B4D4E52DB19BCB5DA131A109FAF472B78EB72996765894D3B8E3361C499E8462732EE846C98AE32A4636B23B425AF95601D281DDE58BAAB60A518C355106AEE5C546D66B9C53E38AA81FFA4E94C802F705944833D0FE946817EB7265515E565DD95EAA6E42C98BC62A483EB43B4659125651CAC1DD715E87E4EBA2AF8AB31E7D639A35D2B2BDA4DCBD4CCF561A1EE42971FB534C2347664B1C822E7A6281C98FDE4A69087B6641CFFB9D8F384B0FA95830A182CD41E9AC63C296E1E4D47AD1F9EFBCAEB84A057C872796777BED60C6B35B9BBA3D7B9AEA038778A2B1FF48E3EF42BAFCBE8AB4E723C68B70EA0F15A9CD1B4DDAEF8DE0DDFAF5831C5EAD452FBCDE6CD2F73B00AB237FD161B610B851E48FB1CD580E9D3F52913E19FFFA90491D91698C29A44F8EC99F2F6ED5F7B0E2359BE1AC1978CB9EB5DE0D3CA3F97E56D3DB51B41EACD1FD7F34B7CD1E637BFBDAD9BD6677EFD00966124F35236F7B4FD7D6D876F6B56DB0AD9DE6815ADEAACDEB46665B97DB688C0FD3D8362B25E448E5A72DE4A6628B3584F9A14B805F6347B9662CE6B220A9A551B1C44A6213D03440EA9CC79ACD3199E1B40F4AA5D7E357CA135C7219CE20188B69A2A344A3C910CE78ED65D7907DD3FE69F75ED779308DD2DEE3354C4035199A0053F139613C28F5BE6AB9C83B204C14E577A6394B6DEECEC5AA44BA966247A0DC7D65F0DF411871045353E1D127788E6EF70ABEC082FAABA2E0ED06D97E1075B70F2E18C52E305439C65A1EBF22878370F9F15F6458AE89E11D0000 , N'6.2.0-61023')
END

